/*		setup.c	Ihsoh	2012-12-30		ISystem setup application	Function:	Copy boot loader to NO.1 sector and	copy kernel to NO.2 sector ~  NO.65 sector*/#define HEAD 0#define CLY 0#define BOOTLOADERS 1#define BOOTLOADERSC 1#define KERNELS 2#define KERNELSC 64#define DRIVER 0x80#define WRITEDISK 3#define BOOTLOADERFILE "boot.bin"#define KERNELFILE "kernel.bin"#define BOOTLOADERLEN 512#define KERNELLEN 32768#define uchar unsigned char #include <stdio.h>#include <bios.h>#include <stdlib.h>int main(){	uchar * BootLoader;	uchar * Kernel;	FILE * FilePtr;	/*Alloc memory*/	BootLoader = (uchar *)malloc(BOOTLOADERLEN);	Kernel = (uchar *)malloc(KERNELLEN);	if(BootLoader == NULL || Kernel == NULL)	{		printf("Alloc memory error!");		return -1;	}	/*Load boot loader*/	FilePtr = fopen(BOOTLOADERFILE, "rb");	if(!FilePtr)	{		printf("Open \"");		printf(BOOTLOADERFILE);		printf("\" error");		return -1;	}	fread(BootLoader, sizeof(uchar), BOOTLOADERLEN, FilePtr);	fclose(FilePtr);	/*Load kernel*/	FilePtr = fopen(KERNELFILE, "rb");	fread(Kernel, sizeof(uchar), KERNELLEN, FilePtr);	if(!FilePtr)	{		printf("Open \"");		printf(KERNELFILE);		printf("\" error");		return -1;	}	fclose(FilePtr);		/*Copy boot loader*/	if(biosdisk(WRITEDISK, DRIVER, HEAD, CLY, BOOTLOADERS, BOOTLOADERSC, BootLoader))	{		printf("Copy boot loader error");		return -1;	}		/*Copy kernel*/	if(biosdisk(WRITEDISK, DRIVER, HEAD, CLY, KERNELS, KERNELSC, Kernel))	{		printf("Copy kernel error");		return -1;	}		/*Print success message*/	printf("%s", "ISystem setup successed!\nPlease restart computer to start ISystem!");		return 0;}